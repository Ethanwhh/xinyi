"""å¿ƒç†è¯„ä¼°ç³»ç»Ÿè·¯ç”±"""
import logging
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.orm import Session
from sqlalchemy import desc
from typing import List
from ..database import get_db
from ..models import User, AssessmentTemplate, AssessmentRecord
from ..schemas import (
    AssessmentTemplateListItem, 
    AssessmentTemplateDetail,
    AssessmentSubmitRequest,
    AssessmentResultResponse,
    AssessmentHistoryItem
)
from ..auth import get_current_user

logger = logging.getLogger(__name__)
router = APIRouter(prefix="/api/assessments", tags=["å¿ƒç†è¯„ä¼°"])


# ç¡¬ç¼–ç è¯„ä¼°é‡è¡¨æ¨¡æ¿æ•°æ®
ASSESSMENT_TEMPLATES = [
    # PHQ-9 æŠ‘éƒé‡è¡¨
    {
        "scale_name": "PHQ-9",
        "display_name": "æ‚£è€…å¥åº·é—®å·-9 (PHQ-9)",
        "category": "depression",
        "description": "PHQ-9æ˜¯ä¸–ç•Œå«ç”Ÿç»„ç»‡æ¨èçš„æŠ‘éƒç—‡çŠ¶ç­›æŸ¥å·¥å…·ï¼ŒåŒ…å«9ä¸ªé—®é¢˜ï¼Œè¯„ä¼°è¿‡å»ä¸¤å‘¨çš„æŠ‘éƒç—‡çŠ¶ä¸¥é‡ç¨‹åº¦ã€‚",
        "question_count": 9,
        "estimated_time": 3,
        "icon": "ğŸ˜”",
        "questions": [
            {
                "id": 1,
                "text": "åšäº‹æ—¶æä¸èµ·åŠ²æˆ–æ²¡æœ‰å…´è¶£",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ä¼š"},
                    {"value": 1, "label": "å¥½å‡ å¤©"},
                    {"value": 2, "label": "ä¸€åŠä»¥ä¸Šçš„å¤©æ•°"},
                    {"value": 3, "label": "å‡ ä¹æ¯å¤©"}
                ]
            },
            {
                "id": 2,
                "text": "æ„Ÿåˆ°å¿ƒæƒ…ä½è½ã€æ²®ä¸§æˆ–ç»æœ›",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ä¼š"},
                    {"value": 1, "label": "å¥½å‡ å¤©"},
                    {"value": 2, "label": "ä¸€åŠä»¥ä¸Šçš„å¤©æ•°"},
                    {"value": 3, "label": "å‡ ä¹æ¯å¤©"}
                ]
            },
            {
                "id": 3,
                "text": "å…¥ç¡å›°éš¾ã€ç¡ä¸å®‰ç¨³æˆ–ç¡çœ è¿‡å¤š",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ä¼š"},
                    {"value": 1, "label": "å¥½å‡ å¤©"},
                    {"value": 2, "label": "ä¸€åŠä»¥ä¸Šçš„å¤©æ•°"},
                    {"value": 3, "label": "å‡ ä¹æ¯å¤©"}
                ]
            },
            {
                "id": 4,
                "text": "æ„Ÿè§‰ç–²å€¦æˆ–æ²¡æœ‰æ´»åŠ›",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ä¼š"},
                    {"value": 1, "label": "å¥½å‡ å¤©"},
                    {"value": 2, "label": "ä¸€åŠä»¥ä¸Šçš„å¤©æ•°"},
                    {"value": 3, "label": "å‡ ä¹æ¯å¤©"}
                ]
            },
            {
                "id": 5,
                "text": "é£Ÿæ¬²ä¸æŒ¯æˆ–åƒå¤ªå¤š",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ä¼š"},
                    {"value": 1, "label": "å¥½å‡ å¤©"},
                    {"value": 2, "label": "ä¸€åŠä»¥ä¸Šçš„å¤©æ•°"},
                    {"value": 3, "label": "å‡ ä¹æ¯å¤©"}
                ]
            },
            {
                "id": 6,
                "text": "è§‰å¾—è‡ªå·±å¾ˆç³Ÿï¼Œæˆ–è§‰å¾—è‡ªå·±å¾ˆå¤±è´¥ï¼Œæˆ–è®©è‡ªå·±æˆ–å®¶äººå¤±æœ›",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ä¼š"},
                    {"value": 1, "label": "å¥½å‡ å¤©"},
                    {"value": 2, "label": "ä¸€åŠä»¥ä¸Šçš„å¤©æ•°"},
                    {"value": 3, "label": "å‡ ä¹æ¯å¤©"}
                ]
            },
            {
                "id": 7,
                "text": "å¯¹äº‹ç‰©ä¸“æ³¨æœ‰å›°éš¾ï¼Œä¾‹å¦‚é˜…è¯»æŠ¥çº¸æˆ–çœ‹ç”µè§†æ—¶",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ä¼š"},
                    {"value": 1, "label": "å¥½å‡ å¤©"},
                    {"value": 2, "label": "ä¸€åŠä»¥ä¸Šçš„å¤©æ•°"},
                    {"value": 3, "label": "å‡ ä¹æ¯å¤©"}
                ]
            },
            {
                "id": 8,
                "text": "åŠ¨ä½œæˆ–è¯´è¯é€Ÿåº¦ç¼“æ…¢åˆ°åˆ«äººå·²ç»æ³¨æ„åˆ°ï¼Ÿæˆ–æ­£å¥½ç›¸åâ€”â€”çƒ¦èºæˆ–åç«‹ä¸å®‰ã€åŠ¨æ¥åŠ¨å»çš„æƒ…å†µæ›´èƒœäºå¹³å¸¸",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ä¼š"},
                    {"value": 1, "label": "å¥½å‡ å¤©"},
                    {"value": 2, "label": "ä¸€åŠä»¥ä¸Šçš„å¤©æ•°"},
                    {"value": 3, "label": "å‡ ä¹æ¯å¤©"}
                ]
            },
            {
                "id": 9,
                "text": "æœ‰ä¸å¦‚æ­»æ‰æˆ–ç”¨æŸç§æ–¹å¼ä¼¤å®³è‡ªå·±çš„å¿µå¤´",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ä¼š"},
                    {"value": 1, "label": "å¥½å‡ å¤©"},
                    {"value": 2, "label": "ä¸€åŠä»¥ä¸Šçš„å¤©æ•°"},
                    {"value": 3, "label": "å‡ ä¹æ¯å¤©"}
                ]
            }
        ],
        "scoring_rules": {
            "method": "sum",
            "max_score": 27
        },
        "interpretation": [
            {
                "range": [0, 4],
                "level": "æ­£å¸¸",
                "interpretation": "æ‚¨ç›®å‰çš„å¿ƒç†çŠ¶æ€è‰¯å¥½ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æŠ‘éƒç—‡çŠ¶ã€‚",
                "suggestion": "å»ºè®®ä¿æŒç§¯æçš„ç”Ÿæ´»æ–¹å¼ï¼Œç»§ç»­å…³æ³¨è‡ªå·±çš„å¿ƒç†å¥åº·ã€‚å¦‚æœ‰éœ€è¦ï¼Œå¯ä»¥éšæ—¶ä¸å¿ƒç¿¼èŠå¤©ã€‚"
            },
            {
                "range": [5, 9],
                "level": "è½»åº¦",
                "interpretation": "æ‚¨å¯èƒ½å­˜åœ¨è½»åº¦æŠ‘éƒç—‡çŠ¶ã€‚è¿™äº›ç—‡çŠ¶å¯èƒ½ä¼šå½±å“æ‚¨çš„æ—¥å¸¸ç”Ÿæ´»ï¼Œä½†é€šè¿‡è‡ªæˆ‘è°ƒèŠ‚å’Œæ”¯æŒå¯ä»¥æ”¹å–„ã€‚",
                "suggestion": "å»ºè®®ï¼š1) ä¸ä¿¡ä»»çš„æœ‹å‹æˆ–å®¶äººäº¤æµæ„Ÿå—ï¼›2) ä¿æŒè§„å¾‹ä½œæ¯å’Œé€‚åº¦è¿åŠ¨ï¼›3) å°è¯•å¿ƒç¿¼çš„å‘¼å¸è®­ç»ƒå’Œæƒ…ç»ªæ—¥è®°åŠŸèƒ½ï¼›4) å¦‚æœç—‡çŠ¶æŒç»­ï¼Œå»ºè®®å’¨è¯¢ä¸“ä¸šå¿ƒç†å’¨è¯¢å¸ˆã€‚"
            },
            {
                "range": [10, 14],
                "level": "ä¸­åº¦",
                "interpretation": "æ‚¨å­˜åœ¨ä¸­åº¦æŠ‘éƒç—‡çŠ¶ï¼Œè¿™äº›ç—‡çŠ¶å¯èƒ½å·²ç»å¯¹æ‚¨çš„ç”Ÿæ´»ã€å·¥ä½œæˆ–å­¦ä¹ é€ æˆä¸€å®šå½±å“ã€‚",
                "suggestion": "å¼ºçƒˆå»ºè®®ï¼š1) å°½å¿«é¢„çº¦ä¸“ä¸šå¿ƒç†å’¨è¯¢æˆ–å¿ƒç†æ²»ç–—ï¼›2) ä¸å®¶äººæˆ–æœ‹å‹åˆ†äº«æ‚¨çš„æ„Ÿå—ï¼›3) ä½¿ç”¨å¿ƒç¿¼çš„è®­ç»ƒåŠŸèƒ½è¿›è¡Œè¾…åŠ©è°ƒèŠ‚ï¼›4) ä¿æŒå¥åº·çš„ç”Ÿæ´»æ–¹å¼ã€‚å¦‚éœ€å¸®åŠ©ï¼Œå¯æ‹¨æ‰“å¿ƒç†æ´åŠ©çƒ­çº¿ï¼š400-161-9995"
            },
            {
                "range": [15, 27],
                "level": "é‡åº¦",
                "interpretation": "æ‚¨å­˜åœ¨é‡åº¦æŠ‘éƒç—‡çŠ¶ï¼Œè¿™å·²ç»ä¸¥é‡å½±å“æ‚¨çš„æ—¥å¸¸ç”Ÿæ´»ã€‚è¯·åŠ¡å¿…é‡è§†å¹¶å¯»æ±‚ä¸“ä¸šå¸®åŠ©ã€‚",
                "suggestion": "âš ï¸ ç´§æ€¥å»ºè®®ï¼š1) ç«‹å³å¯»æ±‚ä¸“ä¸šå¿ƒç†/ç²¾ç¥ç§‘åŒ»ç”Ÿçš„å¸®åŠ©ï¼›2) ä¸è¦ç‹¬è‡ªæ‰¿å—ï¼Œå‘Šè¯‰ä¿¡ä»»çš„äººï¼›3) 24å°æ—¶å¿ƒç†å±æœºå¹²é¢„çƒ­çº¿ï¼š400-161-9995 æˆ– 010-82951332ï¼›4) å¦‚æœ‰è‡ªä¼¤æˆ–è‡ªæ€å¿µå¤´ï¼Œè¯·ç«‹å³æ‹¨æ‰“110æˆ–å‰å¾€æœ€è¿‘çš„åŒ»é™¢æ€¥è¯Šã€‚"
            }
        ]
    },
    
    # GAD-7 ç„¦è™‘é‡è¡¨
    {
        "scale_name": "GAD-7",
        "display_name": "å¹¿æ³›æ€§ç„¦è™‘é‡è¡¨-7 (GAD-7)",
        "category": "anxiety",
        "description": "GAD-7æ˜¯ç­›æŸ¥å¹¿æ³›æ€§ç„¦è™‘éšœç¢çš„æ ‡å‡†å·¥å…·ï¼Œè¯„ä¼°è¿‡å»ä¸¤å‘¨çš„ç„¦è™‘ç—‡çŠ¶ä¸¥é‡ç¨‹åº¦ã€‚",
        "question_count": 7,
        "estimated_time": 2,
        "icon": "ğŸ˜°",
        "questions": [
            {
                "id": 1,
                "text": "æ„Ÿè§‰ç´§å¼ ã€ç„¦è™‘æˆ–æ€¥åˆ‡",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ä¼š"},
                    {"value": 1, "label": "å¥½å‡ å¤©"},
                    {"value": 2, "label": "ä¸€åŠä»¥ä¸Šçš„å¤©æ•°"},
                    {"value": 3, "label": "å‡ ä¹æ¯å¤©"}
                ]
            },
            {
                "id": 2,
                "text": "æ— æ³•åœæ­¢æˆ–æ§åˆ¶æ‹…å¿§",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ä¼š"},
                    {"value": 1, "label": "å¥½å‡ å¤©"},
                    {"value": 2, "label": "ä¸€åŠä»¥ä¸Šçš„å¤©æ•°"},
                    {"value": 3, "label": "å‡ ä¹æ¯å¤©"}
                ]
            },
            {
                "id": 3,
                "text": "å¯¹å„ç§å„æ ·çš„äº‹æƒ…æ‹…å¿§è¿‡å¤š",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ä¼š"},
                    {"value": 1, "label": "å¥½å‡ å¤©"},
                    {"value": 2, "label": "ä¸€åŠä»¥ä¸Šçš„å¤©æ•°"},
                    {"value": 3, "label": "å‡ ä¹æ¯å¤©"}
                ]
            },
            {
                "id": 4,
                "text": "å¾ˆéš¾æ”¾æ¾ä¸‹æ¥",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ä¼š"},
                    {"value": 1, "label": "å¥½å‡ å¤©"},
                    {"value": 2, "label": "ä¸€åŠä»¥ä¸Šçš„å¤©æ•°"},
                    {"value": 3, "label": "å‡ ä¹æ¯å¤©"}
                ]
            },
            {
                "id": 5,
                "text": "ç”±äºä¸å®‰è€Œæ— æ³•é™å",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ä¼š"},
                    {"value": 1, "label": "å¥½å‡ å¤©"},
                    {"value": 2, "label": "ä¸€åŠä»¥ä¸Šçš„å¤©æ•°"},
                    {"value": 3, "label": "å‡ ä¹æ¯å¤©"}
                ]
            },
            {
                "id": 6,
                "text": "å˜å¾—å®¹æ˜“çƒ¦æ¼æˆ–æ€¥èº",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ä¼š"},
                    {"value": 1, "label": "å¥½å‡ å¤©"},
                    {"value": 2, "label": "ä¸€åŠä»¥ä¸Šçš„å¤©æ•°"},
                    {"value": 3, "label": "å‡ ä¹æ¯å¤©"}
                ]
            },
            {
                "id": 7,
                "text": "æ„Ÿåˆ°ä¼¼ä¹å°†æœ‰å¯æ€•çš„äº‹æƒ…å‘ç”Ÿè€Œå®³æ€•",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ä¼š"},
                    {"value": 1, "label": "å¥½å‡ å¤©"},
                    {"value": 2, "label": "ä¸€åŠä»¥ä¸Šçš„å¤©æ•°"},
                    {"value": 3, "label": "å‡ ä¹æ¯å¤©"}
                ]
            }
        ],
        "scoring_rules": {
            "method": "sum",
            "max_score": 21
        },
        "interpretation": [
            {
                "range": [0, 4],
                "level": "æ­£å¸¸",
                "interpretation": "æ‚¨ç›®å‰çš„ç„¦è™‘æ°´å¹³åœ¨æ­£å¸¸èŒƒå›´å†…ï¼Œå¿ƒç†çŠ¶æ€è‰¯å¥½ã€‚",
                "suggestion": "å»ºè®®ä¿æŒå¥åº·çš„ç”Ÿæ´»æ–¹å¼ï¼Œé€‚åº¦è¿åŠ¨ï¼Œä¿è¯å……è¶³ç¡çœ ã€‚å¦‚é‡åˆ°å‹åŠ›äº‹ä»¶ï¼Œå¯ä»¥ä½¿ç”¨å¿ƒç¿¼çš„å‘¼å¸è®­ç»ƒåŠŸèƒ½ã€‚"
            },
            {
                "range": [5, 9],
                "level": "è½»åº¦",
                "interpretation": "æ‚¨å­˜åœ¨è½»åº¦ç„¦è™‘ç—‡çŠ¶ï¼Œè¿™å¯èƒ½å½±å“æ‚¨çš„æ—¥å¸¸ç”Ÿæ´»è´¨é‡ã€‚",
                "suggestion": "å»ºè®®ï¼š1) å­¦ä¹ æ”¾æ¾æŠ€å·§ï¼ˆå¦‚æ·±å‘¼å¸ã€æ­£å¿µå†¥æƒ³ï¼‰ï¼›2) è¯†åˆ«å¹¶æŒ‘æˆ˜ç„¦è™‘æ€ç»´ï¼›3) ä½¿ç”¨å¿ƒç¿¼çš„ç„¦è™‘è®­ç»ƒæ¨¡å—ï¼›4) ä¿æŒè§„å¾‹ä½œæ¯å’Œé€‚åº¦è¿åŠ¨ï¼›5) å¦‚ç—‡çŠ¶æŒç»­ï¼Œè€ƒè™‘å’¨è¯¢å¿ƒç†ä¸“ä¸šäººå£«ã€‚"
            },
            {
                "range": [10, 14],
                "level": "ä¸­åº¦",
                "interpretation": "æ‚¨å­˜åœ¨ä¸­åº¦ç„¦è™‘ç—‡çŠ¶ï¼Œè¿™å·²ç»å¯¹æ‚¨çš„ç”Ÿæ´»é€ æˆæ˜æ˜¾å½±å“ã€‚",
                "suggestion": "å¼ºçƒˆå»ºè®®ï¼š1) å¯»æ±‚ä¸“ä¸šå¿ƒç†å’¨è¯¢æˆ–æ²»ç–—ï¼›2) å­¦ä¹ å¹¶å®è·µæ”¾æ¾æŠ€æœ¯ï¼›3) å‡å°‘å’–å•¡å› æ‘„å…¥ï¼›4) ä½¿ç”¨å¿ƒç¿¼çš„è®­ç»ƒåŠŸèƒ½è¾…åŠ©è°ƒèŠ‚ï¼›5) ä¸ä¿¡ä»»çš„äººåˆ†äº«æ„Ÿå—ã€‚å¿ƒç†æ´åŠ©çƒ­çº¿ï¼š400-161-9995"
            },
            {
                "range": [15, 21],
                "level": "é‡åº¦",
                "interpretation": "æ‚¨å­˜åœ¨é‡åº¦ç„¦è™‘ç—‡çŠ¶ï¼Œä¸¥é‡å½±å“æ—¥å¸¸ç”Ÿæ´»ã€‚è¯·åŠ¡å¿…å¯»æ±‚ä¸“ä¸šå¸®åŠ©ã€‚",
                "suggestion": "âš ï¸ ç´§æ€¥å»ºè®®ï¼š1) ç«‹å³é¢„çº¦å¿ƒç†åŒ»ç”Ÿæˆ–ç²¾ç¥ç§‘åŒ»ç”Ÿï¼›2) è€ƒè™‘è¯ç‰©æ²»ç–—é…åˆå¿ƒç†æ²»ç–—ï¼›3) é¿å…è‡ªæˆ‘å­¤ç«‹ï¼Œå¯»æ±‚æ”¯æŒï¼›4) 24å°æ—¶å¿ƒç†æ´åŠ©çƒ­çº¿ï¼š400-161-9995 æˆ– 010-82951332ã€‚"
            }
        ]
    },
    
    # PSS-10 å‹åŠ›é‡è¡¨
    {
        "scale_name": "PSS-10",
        "display_name": "çŸ¥è§‰å‹åŠ›é‡è¡¨-10 (PSS-10)",
        "category": "stress",
        "description": "PSS-10è¯„ä¼°ä¸ªä½“åœ¨è¿‡å»ä¸€ä¸ªæœˆå†…ä¸»è§‚æ„Ÿå—åˆ°çš„å‹åŠ›æ°´å¹³ï¼Œå¸®åŠ©äº†è§£æ‚¨å¯¹ç”Ÿæ´»ä¸­ä¸å¯é¢„æµ‹æ€§å’Œä¸å¯æ§äº‹ä»¶çš„æ„ŸçŸ¥ã€‚",
        "question_count": 10,
        "estimated_time": 3,
        "icon": "ğŸ˜«",
        "questions": [
            {
                "id": 1,
                "text": "åœ¨è¿‡å»ä¸€ä¸ªæœˆä¸­ï¼Œæ‚¨æœ‰å¤šç»å¸¸å› ä¸ºå‘ç”Ÿæ„æƒ³ä¸åˆ°çš„äº‹æƒ…è€Œæ„Ÿåˆ°å¿ƒçƒ¦æ„ä¹±ï¼Ÿ",
                "options": [
                    {"value": 0, "label": "ä»ä¸"},
                    {"value": 1, "label": "å‡ ä¹ä¸"},
                    {"value": 2, "label": "æœ‰æ—¶"},
                    {"value": 3, "label": "ç›¸å½“å¸¸"},
                    {"value": 4, "label": "éå¸¸å¸¸"}
                ]
            },
            {
                "id": 2,
                "text": "åœ¨è¿‡å»ä¸€ä¸ªæœˆä¸­ï¼Œæ‚¨æœ‰å¤šç»å¸¸è§‰å¾—æ— æ³•æ§åˆ¶ç”Ÿæ´»ä¸­é‡è¦çš„äº‹æƒ…ï¼Ÿ",
                "options": [
                    {"value": 0, "label": "ä»ä¸"},
                    {"value": 1, "label": "å‡ ä¹ä¸"},
                    {"value": 2, "label": "æœ‰æ—¶"},
                    {"value": 3, "label": "ç›¸å½“å¸¸"},
                    {"value": 4, "label": "éå¸¸å¸¸"}
                ]
            },
            {
                "id": 3,
                "text": "åœ¨è¿‡å»ä¸€ä¸ªæœˆä¸­ï¼Œæ‚¨æœ‰å¤šç»å¸¸æ„Ÿåˆ°ç´§å¼ å’Œå‹åŠ›ï¼Ÿ",
                "options": [
                    {"value": 0, "label": "ä»ä¸"},
                    {"value": 1, "label": "å‡ ä¹ä¸"},
                    {"value": 2, "label": "æœ‰æ—¶"},
                    {"value": 3, "label": "ç›¸å½“å¸¸"},
                    {"value": 4, "label": "éå¸¸å¸¸"}
                ]
            },
            {
                "id": 4,
                "text": "åœ¨è¿‡å»ä¸€ä¸ªæœˆä¸­ï¼Œæ‚¨æœ‰å¤šè‡ªä¿¡èƒ½å¤Ÿå¤„ç†è‡ªå·±çš„ç§äº‹ï¼Ÿï¼ˆåå‘è®¡åˆ†ï¼‰",
                "options": [
                    {"value": 4, "label": "ä»ä¸"},
                    {"value": 3, "label": "å‡ ä¹ä¸"},
                    {"value": 2, "label": "æœ‰æ—¶"},
                    {"value": 1, "label": "ç›¸å½“å¸¸"},
                    {"value": 0, "label": "éå¸¸å¸¸"}
                ]
            },
            {
                "id": 5,
                "text": "åœ¨è¿‡å»ä¸€ä¸ªæœˆä¸­ï¼Œæ‚¨æœ‰å¤šç»å¸¸è§‰å¾—äº‹æƒ…æŒ‰æ‚¨çš„æ„æ„¿å‘å±•ï¼Ÿï¼ˆåå‘è®¡åˆ†ï¼‰",
                "options": [
                    {"value": 4, "label": "ä»ä¸"},
                    {"value": 3, "label": "å‡ ä¹ä¸"},
                    {"value": 2, "label": "æœ‰æ—¶"},
                    {"value": 1, "label": "ç›¸å½“å¸¸"},
                    {"value": 0, "label": "éå¸¸å¸¸"}
                ]
            },
            {
                "id": 6,
                "text": "åœ¨è¿‡å»ä¸€ä¸ªæœˆä¸­ï¼Œæ‚¨æœ‰å¤šç»å¸¸å‘ç°è‡ªå·±æ— æ³•å¤„ç†æ‰€æœ‰å¿…é¡»åšçš„äº‹æƒ…ï¼Ÿ",
                "options": [
                    {"value": 0, "label": "ä»ä¸"},
                    {"value": 1, "label": "å‡ ä¹ä¸"},
                    {"value": 2, "label": "æœ‰æ—¶"},
                    {"value": 3, "label": "ç›¸å½“å¸¸"},
                    {"value": 4, "label": "éå¸¸å¸¸"}
                ]
            },
            {
                "id": 7,
                "text": "åœ¨è¿‡å»ä¸€ä¸ªæœˆä¸­ï¼Œæ‚¨æœ‰å¤šç»å¸¸èƒ½å¤Ÿæ§åˆ¶ç”Ÿæ´»ä¸­çš„çƒ¦å¿ƒäº‹ï¼Ÿï¼ˆåå‘è®¡åˆ†ï¼‰",
                "options": [
                    {"value": 4, "label": "ä»ä¸"},
                    {"value": 3, "label": "å‡ ä¹ä¸"},
                    {"value": 2, "label": "æœ‰æ—¶"},
                    {"value": 1, "label": "ç›¸å½“å¸¸"},
                    {"value": 0, "label": "éå¸¸å¸¸"}
                ]
            },
            {
                "id": 8,
                "text": "åœ¨è¿‡å»ä¸€ä¸ªæœˆä¸­ï¼Œæ‚¨æœ‰å¤šç»å¸¸è§‰å¾—ä¸€åˆ‡éƒ½åœ¨æŒæ§ä¹‹ä¸­ï¼Ÿï¼ˆåå‘è®¡åˆ†ï¼‰",
                "options": [
                    {"value": 4, "label": "ä»ä¸"},
                    {"value": 3, "label": "å‡ ä¹ä¸"},
                    {"value": 2, "label": "æœ‰æ—¶"},
                    {"value": 1, "label": "ç›¸å½“å¸¸"},
                    {"value": 0, "label": "éå¸¸å¸¸"}
                ]
            },
            {
                "id": 9,
                "text": "åœ¨è¿‡å»ä¸€ä¸ªæœˆä¸­ï¼Œæ‚¨æœ‰å¤šç»å¸¸å› ä¸ºäº‹æƒ…ä¸åœ¨æ‚¨çš„æ§åˆ¶èŒƒå›´å†…è€Œç”Ÿæ°”ï¼Ÿ",
                "options": [
                    {"value": 0, "label": "ä»ä¸"},
                    {"value": 1, "label": "å‡ ä¹ä¸"},
                    {"value": 2, "label": "æœ‰æ—¶"},
                    {"value": 3, "label": "ç›¸å½“å¸¸"},
                    {"value": 4, "label": "éå¸¸å¸¸"}
                ]
            },
            {
                "id": 10,
                "text": "åœ¨è¿‡å»ä¸€ä¸ªæœˆä¸­ï¼Œæ‚¨æœ‰å¤šç»å¸¸è§‰å¾—å›°éš¾å †ç§¯å¦‚å±±ï¼Œæ— æ³•å…‹æœï¼Ÿ",
                "options": [
                    {"value": 0, "label": "ä»ä¸"},
                    {"value": 1, "label": "å‡ ä¹ä¸"},
                    {"value": 2, "label": "æœ‰æ—¶"},
                    {"value": 3, "label": "ç›¸å½“å¸¸"},
                    {"value": 4, "label": "éå¸¸å¸¸"}
                ]
            }
        ],
        "scoring_rules": {
            "method": "sum",
            "max_score": 40
        },
        "interpretation": [
            {
                "range": [0, 13],
                "level": "ä½å‹åŠ›",
                "interpretation": "æ‚¨ç›®å‰çš„å‹åŠ›æ°´å¹³è¾ƒä½ï¼Œåº”å¯¹ç”Ÿæ´»çš„èƒ½åŠ›è‰¯å¥½ã€‚",
                "suggestion": "å»ºè®®ç»§ç»­ä¿æŒå¥åº·çš„ç”Ÿæ´»æ–¹å¼ï¼Œé€‚æ—¶æ”¾æ¾å’Œå¨±ä¹ã€‚å¦‚é‡åˆ°æ–°çš„å‹åŠ›æºï¼Œå¯ä»¥ä½¿ç”¨å¿ƒç¿¼çš„å‹åŠ›ç®¡ç†å·¥å…·ã€‚"
            },
            {
                "range": [14, 26],
                "level": "ä¸­ç­‰å‹åŠ›",
                "interpretation": "æ‚¨ç›®å‰æ‰¿å—ç€ä¸­ç­‰ç¨‹åº¦çš„å‹åŠ›ï¼Œè¿™æ˜¯è¾ƒä¸ºå¸¸è§çš„çŠ¶æ€ã€‚",
                "suggestion": "å»ºè®®ï¼š1) è¯†åˆ«ä¸»è¦å‹åŠ›æºï¼›2) å­¦ä¹ æ—¶é—´ç®¡ç†æŠ€å·§ï¼›3) å®è·µæ”¾æ¾æŠ€æœ¯ï¼ˆå¦‚æ·±å‘¼å¸ã€æ­£å¿µï¼‰ï¼›4) ä¿æŒç¤¾äº¤è”ç³»ï¼›5) ç¡®ä¿å……è¶³ç¡çœ å’Œè§„å¾‹è¿åŠ¨ï¼›6) ä½¿ç”¨å¿ƒç¿¼çš„å‹åŠ›ç¼“è§£è®­ç»ƒã€‚"
            },
            {
                "range": [27, 40],
                "level": "é«˜å‹åŠ›",
                "interpretation": "æ‚¨ç›®å‰æ‰¿å—ç€è¾ƒé«˜æ°´å¹³çš„å‹åŠ›ï¼Œè¿™å¯èƒ½å½±å“æ‚¨çš„èº«å¿ƒå¥åº·ã€‚",
                "suggestion": "å¼ºçƒˆå»ºè®®ï¼š1) è¯„ä¼°å¹¶å‡å°‘å¯é¿å…çš„å‹åŠ›æºï¼›2) å¯»æ±‚ä¸“ä¸šå¿ƒç†å’¨è¯¢ï¼›3) å­¦ä¹ æœ‰æ•ˆçš„åº”å¯¹ç­–ç•¥ï¼›4) åŠ å¼ºç¤¾ä¼šæ”¯æŒç³»ç»Ÿï¼›5) æ³¨æ„èº«ä½“å¥åº·ä¿¡å·ï¼›6) ä½¿ç”¨å¿ƒç¿¼çš„ç»¼åˆè®­ç»ƒè®¡åˆ’ã€‚å¦‚éœ€å¸®åŠ©ï¼šå¿ƒç†æ´åŠ©çƒ­çº¿ 400-161-9995"
            }
        ]
    },
    
    # ISI å¤±çœ ä¸¥é‡ç¨‹åº¦æŒ‡æ•°
    {
        "scale_name": "ISI",
        "display_name": "å¤±çœ ä¸¥é‡ç¨‹åº¦æŒ‡æ•° (ISI)",
        "category": "sleep",
        "description": "ISIæ˜¯è¯„ä¼°å¤±çœ ç—‡çŠ¶ä¸¥é‡ç¨‹åº¦çš„ç®€çŸ­é‡è¡¨ï¼Œå¸®åŠ©äº†è§£æ‚¨åœ¨è¿‡å»ä¸¤å‘¨çš„ç¡çœ è´¨é‡å’Œå¤±çœ å›°æ‰°ã€‚",
        "question_count": 7,
        "estimated_time": 2,
        "icon": "ğŸ˜´",
        "questions": [
            {
                "id": 1,
                "text": "æ‚¨å…¥ç¡å›°éš¾çš„ä¸¥é‡ç¨‹åº¦å¦‚ä½•ï¼Ÿ",
                "options": [
                    {"value": 0, "label": "æ²¡æœ‰"},
                    {"value": 1, "label": "è½»åº¦"},
                    {"value": 2, "label": "ä¸­åº¦"},
                    {"value": 3, "label": "é‡åº¦"},
                    {"value": 4, "label": "éå¸¸é‡åº¦"}
                ]
            },
            {
                "id": 2,
                "text": "æ‚¨ç»´æŒç¡çœ å›°éš¾ï¼ˆåŠå¤œé†’æ¥ï¼‰çš„ä¸¥é‡ç¨‹åº¦å¦‚ä½•ï¼Ÿ",
                "options": [
                    {"value": 0, "label": "æ²¡æœ‰"},
                    {"value": 1, "label": "è½»åº¦"},
                    {"value": 2, "label": "ä¸­åº¦"},
                    {"value": 3, "label": "é‡åº¦"},
                    {"value": 4, "label": "éå¸¸é‡åº¦"}
                ]
            },
            {
                "id": 3,
                "text": "æ‚¨æ—©é†’é—®é¢˜çš„ä¸¥é‡ç¨‹åº¦å¦‚ä½•ï¼Ÿ",
                "options": [
                    {"value": 0, "label": "æ²¡æœ‰"},
                    {"value": 1, "label": "è½»åº¦"},
                    {"value": 2, "label": "ä¸­åº¦"},
                    {"value": 3, "label": "é‡åº¦"},
                    {"value": 4, "label": "éå¸¸é‡åº¦"}
                ]
            },
            {
                "id": 4,
                "text": "æ‚¨å¯¹ç›®å‰ç¡çœ çŠ¶å†µçš„æ»¡æ„ç¨‹åº¦å¦‚ä½•ï¼Ÿ",
                "options": [
                    {"value": 0, "label": "éå¸¸æ»¡æ„"},
                    {"value": 1, "label": "æ»¡æ„"},
                    {"value": 2, "label": "ä¸­ç­‰æ»¡æ„"},
                    {"value": 3, "label": "ä¸æ»¡æ„"},
                    {"value": 4, "label": "éå¸¸ä¸æ»¡æ„"}
                ]
            },
            {
                "id": 5,
                "text": "æ‚¨è®¤ä¸ºåˆ«äººæ³¨æ„åˆ°æ‚¨çš„ç¡çœ é—®é¢˜å½±å“äº†æ‚¨çš„ç”Ÿæ´»è´¨é‡çš„ç¨‹åº¦å¦‚ä½•ï¼Ÿ",
                "options": [
                    {"value": 0, "label": "å®Œå…¨æ²¡æœ‰æ³¨æ„åˆ°"},
                    {"value": 1, "label": "æœ‰ç‚¹æ³¨æ„åˆ°"},
                    {"value": 2, "label": "å¾ˆæ³¨æ„åˆ°"},
                    {"value": 3, "label": "éå¸¸æ³¨æ„åˆ°"},
                    {"value": 4, "label": "æå…¶æ³¨æ„åˆ°"}
                ]
            },
            {
                "id": 6,
                "text": "æ‚¨å¯¹ç›®å‰ç¡çœ é—®é¢˜çš„æ‹…å¿ƒæˆ–è‹¦æ¼ç¨‹åº¦å¦‚ä½•ï¼Ÿ",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸æ‹…å¿ƒ"},
                    {"value": 1, "label": "æœ‰ç‚¹æ‹…å¿ƒ"},
                    {"value": 2, "label": "ä¸­ç­‰æ‹…å¿ƒ"},
                    {"value": 3, "label": "å¾ˆæ‹…å¿ƒ"},
                    {"value": 4, "label": "éå¸¸æ‹…å¿ƒ"}
                ]
            },
            {
                "id": 7,
                "text": "æ‚¨è®¤ä¸ºç¡çœ é—®é¢˜å½±å“æ—¥å¸¸åŠŸèƒ½ï¼ˆå¦‚ç™½å¤©ç–²åŠ³ã€å·¥ä½œ/å­¦ä¹ èƒ½åŠ›ã€æ³¨æ„åŠ›ã€è®°å¿†åŠ›ã€æƒ…ç»ªç­‰ï¼‰çš„ç¨‹åº¦å¦‚ä½•ï¼Ÿ",
                "options": [
                    {"value": 0, "label": "å®Œå…¨æ²¡æœ‰å½±å“"},
                    {"value": 1, "label": "æœ‰ç‚¹å½±å“"},
                    {"value": 2, "label": "ä¸­ç­‰å½±å“"},
                    {"value": 3, "label": "å¾ˆå¤§å½±å“"},
                    {"value": 4, "label": "éå¸¸å¤§å½±å“"}
                ]
            }
        ],
        "scoring_rules": {
            "method": "sum",
            "max_score": 28
        },
        "interpretation": [
            {
                "range": [0, 7],
                "level": "æ— å¤±çœ ",
                "interpretation": "æ‚¨çš„ç¡çœ çŠ¶å†µè‰¯å¥½ï¼Œæ²¡æœ‰æ˜æ˜¾çš„å¤±çœ é—®é¢˜ã€‚",
                "suggestion": "å»ºè®®ä¿æŒè‰¯å¥½çš„ç¡çœ ä¹ æƒ¯ï¼š1) è§„å¾‹ä½œæ¯ï¼›2) ç¡å‰é¿å…ä½¿ç”¨ç”µå­è®¾å¤‡ï¼›3) åˆ›é€ èˆ’é€‚çš„ç¡çœ ç¯å¢ƒï¼›4) é€‚åº¦è¿åŠ¨ä½†é¿å…ç¡å‰å‰§çƒˆè¿åŠ¨ã€‚"
            },
            {
                "range": [8, 14],
                "level": "è½»åº¦å¤±çœ ",
                "interpretation": "æ‚¨å­˜åœ¨è½»åº¦å¤±çœ ç—‡çŠ¶ï¼Œå¯èƒ½å¶å°”å½±å“ç¡çœ è´¨é‡ã€‚",
                "suggestion": "å»ºè®®ï¼š1) å»ºç«‹è§„å¾‹çš„ç¡çœ ä½œæ¯ï¼›2) ç¡å‰1å°æ—¶æ”¾æ¾æ´»åŠ¨ï¼ˆå¦‚é˜…è¯»ã€å¬éŸ³ä¹ï¼‰ï¼›3) é¿å…å’–å•¡å› å’Œé…’ç²¾ï¼›4) ä½¿ç”¨å¿ƒç¿¼çš„ç¡çœ å†¥æƒ³è®­ç»ƒï¼›5) è®°å½•ç¡çœ æ—¥è®°äº†è§£ç¡çœ æ¨¡å¼ã€‚"
            },
            {
                "range": [15, 21],
                "level": "ä¸­åº¦å¤±çœ ",
                "interpretation": "æ‚¨å­˜åœ¨ä¸­åº¦å¤±çœ ç—‡çŠ¶ï¼Œå·²ç»æ˜æ˜¾å½±å“æ‚¨çš„ç¡çœ è´¨é‡å’Œæ—¥å¸¸åŠŸèƒ½ã€‚",
                "suggestion": "å¼ºçƒˆå»ºè®®ï¼š1) å’¨è¯¢ç¡çœ ä¸“ç§‘åŒ»ç”Ÿæˆ–å¿ƒç†æ²»ç–—å¸ˆï¼›2) å­¦ä¹ è®¤çŸ¥è¡Œä¸ºç–—æ³•ï¼ˆCBT-Iï¼‰æŠ€å·§ï¼›3) æ’æŸ¥å¯èƒ½çš„åŒ»å­¦åŸå› ï¼›4) ä½¿ç”¨å¿ƒç¿¼çš„ç¡çœ æ”¹å–„è®­ç»ƒè®¡åˆ’ï¼›5) é¿å…ç™½å¤©å°ç¡ï¼›6) å»ºç«‹æ”¾æ¾çš„ç¡å‰ä»ªå¼ã€‚"
            },
            {
                "range": [22, 28],
                "level": "é‡åº¦å¤±çœ ",
                "interpretation": "æ‚¨å­˜åœ¨é‡åº¦å¤±çœ ç—‡çŠ¶ï¼Œä¸¥é‡å½±å“èº«å¿ƒå¥åº·å’Œæ—¥å¸¸ç”Ÿæ´»ã€‚",
                "suggestion": "âš ï¸ ç´§æ€¥å»ºè®®ï¼š1) å°½å¿«å°±åŒ»ï¼Œå¯»æ±‚ä¸“ä¸šç¡çœ åŒ»å­¦æˆ–ç²¾ç¥ç§‘è¯„ä¼°ï¼›2) å¯èƒ½éœ€è¦è¯ç‰©é…åˆå¿ƒç†æ²»ç–—ï¼›3) å…¨é¢è¯„ä¼°èº«ä½“å¥åº·çŠ¶å†µï¼›4) é¿å…è‡ªè¡Œæœç”¨åŠ©çœ è¯ç‰©ï¼›5) å¿ƒç†æ´åŠ©çƒ­çº¿ï¼š400-161-9995ã€‚é•¿æœŸå¤±çœ ä¼šå½±å“å…ç–«åŠ›ã€æƒ…ç»ªå’Œè®¤çŸ¥åŠŸèƒ½ï¼Œè¯·åŠ¡å¿…é‡è§†ã€‚"
            }
        ]
    },
    
    # CD-RISC-10 å¿ƒç†éŸ§æ€§é‡è¡¨
    {
        "scale_name": "CD-RISC-10",
        "display_name": "ç®€ç‰ˆå¿ƒç†éŸ§æ€§é‡è¡¨ (CD-RISC-10)",
        "category": "resilience",
        "description": "CD-RISC-10è¯„ä¼°æ‚¨åœ¨é¢å¯¹å‹åŠ›ã€é€†å¢ƒå’Œåˆ›ä¼¤æ—¶çš„å¿ƒç†å¼¹æ€§å’Œæ¢å¤èƒ½åŠ›ï¼Œå¸®åŠ©äº†è§£æ‚¨çš„å¿ƒç†éŸ§æ€§æ°´å¹³ã€‚",
        "question_count": 10,
        "estimated_time": 3,
        "icon": "ğŸ’ª",
        "questions": [
            {
                "id": 1,
                "text": "æˆ‘èƒ½å¤Ÿé€‚åº”å˜åŒ–",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ç¬¦åˆ"},
                    {"value": 1, "label": "å¾ˆå°‘ç¬¦åˆ"},
                    {"value": 2, "label": "æœ‰æ—¶ç¬¦åˆ"},
                    {"value": 3, "label": "ç»å¸¸ç¬¦åˆ"},
                    {"value": 4, "label": "å‡ ä¹æ€»æ˜¯ç¬¦åˆ"}
                ]
            },
            {
                "id": 2,
                "text": "æ— è®ºå‘ç”Ÿä»€ä¹ˆï¼Œæˆ‘éƒ½èƒ½å¤„ç†",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ç¬¦åˆ"},
                    {"value": 1, "label": "å¾ˆå°‘ç¬¦åˆ"},
                    {"value": 2, "label": "æœ‰æ—¶ç¬¦åˆ"},
                    {"value": 3, "label": "ç»å¸¸ç¬¦åˆ"},
                    {"value": 4, "label": "å‡ ä¹æ€»æ˜¯ç¬¦åˆ"}
                ]
            },
            {
                "id": 3,
                "text": "æˆ‘å°½åŠ›ä»æŒ«æŠ˜ä¸­è¿…é€Ÿæ¢å¤",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ç¬¦åˆ"},
                    {"value": 1, "label": "å¾ˆå°‘ç¬¦åˆ"},
                    {"value": 2, "label": "æœ‰æ—¶ç¬¦åˆ"},
                    {"value": 3, "label": "ç»å¸¸ç¬¦åˆ"},
                    {"value": 4, "label": "å‡ ä¹æ€»æ˜¯ç¬¦åˆ"}
                ]
            },
            {
                "id": 4,
                "text": "å‹åŠ›åè€Œèƒ½è®©æˆ‘å˜å¾—æ›´å¼º",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ç¬¦åˆ"},
                    {"value": 1, "label": "å¾ˆå°‘ç¬¦åˆ"},
                    {"value": 2, "label": "æœ‰æ—¶ç¬¦åˆ"},
                    {"value": 3, "label": "ç»å¸¸ç¬¦åˆ"},
                    {"value": 4, "label": "å‡ ä¹æ€»æ˜¯ç¬¦åˆ"}
                ]
            },
            {
                "id": 5,
                "text": "æˆ‘å€¾å‘äºä»å›°éš¾ä¸­æ¢å¤å¾—å¾ˆå¥½",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ç¬¦åˆ"},
                    {"value": 1, "label": "å¾ˆå°‘ç¬¦åˆ"},
                    {"value": 2, "label": "æœ‰æ—¶ç¬¦åˆ"},
                    {"value": 3, "label": "ç»å¸¸ç¬¦åˆ"},
                    {"value": 4, "label": "å‡ ä¹æ€»æ˜¯ç¬¦åˆ"}
                ]
            },
            {
                "id": 6,
                "text": "æˆ‘ç›¸ä¿¡æˆ‘èƒ½å®ç°è‡ªå·±çš„ç›®æ ‡ï¼Œå³ä½¿æœ‰éšœç¢",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ç¬¦åˆ"},
                    {"value": 1, "label": "å¾ˆå°‘ç¬¦åˆ"},
                    {"value": 2, "label": "æœ‰æ—¶ç¬¦åˆ"},
                    {"value": 3, "label": "ç»å¸¸ç¬¦åˆ"},
                    {"value": 4, "label": "å‡ ä¹æ€»æ˜¯ç¬¦åˆ"}
                ]
            },
            {
                "id": 7,
                "text": "å³ä½¿äº‹æƒ…çœ‹èµ·æ¥æ²¡æœ‰å¸Œæœ›ï¼Œæˆ‘ä¹Ÿä¸è½»æ˜“æ”¾å¼ƒ",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ç¬¦åˆ"},
                    {"value": 1, "label": "å¾ˆå°‘ç¬¦åˆ"},
                    {"value": 2, "label": "æœ‰æ—¶ç¬¦åˆ"},
                    {"value": 3, "label": "ç»å¸¸ç¬¦åˆ"},
                    {"value": 4, "label": "å‡ ä¹æ€»æ˜¯ç¬¦åˆ"}
                ]
            },
            {
                "id": 8,
                "text": "åœ¨å‹åŠ›æƒ…å¢ƒä¸‹ï¼Œæˆ‘çŸ¥é“è¯¥å»æ‰¾è°å¸®å¿™",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ç¬¦åˆ"},
                    {"value": 1, "label": "å¾ˆå°‘ç¬¦åˆ"},
                    {"value": 2, "label": "æœ‰æ—¶ç¬¦åˆ"},
                    {"value": 3, "label": "ç»å¸¸ç¬¦åˆ"},
                    {"value": 4, "label": "å‡ ä¹æ€»æ˜¯ç¬¦åˆ"}
                ]
            },
            {
                "id": 9,
                "text": "æˆ‘ä¸ä¼šå› ä¸ºå¤±è´¥æˆ–æŒ«æŠ˜è€Œæ°”é¦",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ç¬¦åˆ"},
                    {"value": 1, "label": "å¾ˆå°‘ç¬¦åˆ"},
                    {"value": 2, "label": "æœ‰æ—¶ç¬¦åˆ"},
                    {"value": 3, "label": "ç»å¸¸ç¬¦åˆ"},
                    {"value": 4, "label": "å‡ ä¹æ€»æ˜¯ç¬¦åˆ"}
                ]
            },
            {
                "id": 10,
                "text": "æˆ‘è®¤ä¸ºè‡ªå·±æ˜¯ä¸€ä¸ªåšå¼ºçš„äºº",
                "options": [
                    {"value": 0, "label": "å®Œå…¨ä¸ç¬¦åˆ"},
                    {"value": 1, "label": "å¾ˆå°‘ç¬¦åˆ"},
                    {"value": 2, "label": "æœ‰æ—¶ç¬¦åˆ"},
                    {"value": 3, "label": "ç»å¸¸ç¬¦åˆ"},
                    {"value": 4, "label": "å‡ ä¹æ€»æ˜¯ç¬¦åˆ"}
                ]
            }
        ],
        "scoring_rules": {
            "method": "sum",
            "max_score": 40
        },
        "interpretation": [
            {
                "range": [0, 20],
                "level": "å¿ƒç†éŸ§æ€§è¾ƒä½",
                "interpretation": "æ‚¨åœ¨é¢å¯¹å‹åŠ›å’Œé€†å¢ƒæ—¶å¯èƒ½æ„Ÿåˆ°è¾ƒä¸ºå›°éš¾ï¼Œæ¢å¤èƒ½åŠ›ç›¸å¯¹è¾ƒå¼±ã€‚",
                "suggestion": "å»ºè®®ï¼š1) å­¦ä¹ ç§¯æåº”å¯¹ç­–ç•¥ï¼›2) åŸ¹å…»æˆé•¿å‹æ€ç»´æ¨¡å¼ï¼›3) å»ºç«‹æ”¯æŒæ€§ç¤¾äº¤ç½‘ç»œï¼›4) è®¾å®šå°è€Œå¯å®ç°çš„ç›®æ ‡å¢å¼ºä¿¡å¿ƒï¼›5) ä½¿ç”¨å¿ƒç¿¼çš„å¿ƒç†éŸ§æ€§è®­ç»ƒæ¨¡å—ï¼›6) è€ƒè™‘å¯»æ±‚å¿ƒç†å’¨è¯¢å¸®åŠ©æå‡åº”å¯¹èƒ½åŠ›ã€‚è®°ä½ï¼Œå¿ƒç†éŸ§æ€§æ˜¯å¯ä»¥åŸ¹å…»çš„ï¼"
            },
            {
                "range": [21, 30],
                "level": "å¿ƒç†éŸ§æ€§ä¸­ç­‰",
                "interpretation": "æ‚¨å…·å¤‡ä¸€å®šçš„å¿ƒç†éŸ§æ€§ï¼Œèƒ½å¤Ÿåº”å¯¹å¤§å¤šæ•°å‹åŠ›æƒ…å¢ƒï¼Œä½†ä»æœ‰æå‡ç©ºé—´ã€‚",
                "suggestion": "å»ºè®®ï¼š1) ç»§ç»­å‘å±•ç§¯æåº”å¯¹ç­–ç•¥ï¼›2) ä»è¿‡å¾€å…‹æœå›°éš¾çš„ç»å†ä¸­æ±²å–åŠ›é‡ï¼›3) ä¿æŒä¹è§‚ä½†ç°å®çš„æ€åº¦ï¼›4) å®šæœŸåæ€å’Œæ€»ç»“åº”å¯¹ç»éªŒï¼›5) ä½¿ç”¨å¿ƒç¿¼çš„è¿›é˜¶è®­ç»ƒæå‡éŸ§æ€§ï¼›6) åœ¨é‡åˆ°é‡å¤§æŒ‘æˆ˜æ—¶ä¸»åŠ¨å¯»æ±‚æ”¯æŒã€‚"
            },
            {
                "range": [31, 40],
                "level": "å¿ƒç†éŸ§æ€§è¾ƒé«˜",
                "interpretation": "æ‚¨å…·æœ‰å¾ˆå¼ºçš„å¿ƒç†éŸ§æ€§ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåº”å¯¹å‹åŠ›ã€ä»æŒ«æŠ˜ä¸­å¿«é€Ÿæ¢å¤ï¼Œå¹¶åœ¨é€†å¢ƒä¸­æˆé•¿ã€‚",
                "suggestion": "ä¼˜ç§€ï¼ç»§ç»­ä¿æŒï¼š1) å°†æ‚¨çš„åº”å¯¹ç»éªŒåˆ†äº«ç»™ä»–äººï¼›2) åœ¨æ–°çš„æŒ‘æˆ˜ä¸­ç»§ç»­ç£¨ç»ƒéŸ§æ€§ï¼›3) å¸®åŠ©ä»–äººæå‡å¿ƒç†éŸ§æ€§ï¼›4) ä¿æŒè‡ªæˆ‘è§‰å¯Ÿï¼Œæ³¨æ„èº«å¿ƒå¹³è¡¡ï¼›5) ä½¿ç”¨å¿ƒç¿¼è®°å½•å’Œåæ€æˆé•¿å†ç¨‹ã€‚æ‚¨çš„éŸ§æ€§æ˜¯å®è´µçš„å¿ƒç†èµ„æºï¼"
            }
        ]
    },
    
    # LSAS ç¤¾äº¤ç„¦è™‘é‡è¡¨ï¼ˆç®€ç‰ˆï¼‰
    {
        "scale_name": "LSAS-Brief",
        "display_name": "ç¤¾äº¤ç„¦è™‘é‡è¡¨-ç®€ç‰ˆ (LSAS-Brief)",
        "category": "social",
        "description": "LSASç®€ç‰ˆè¯„ä¼°æ‚¨åœ¨ç¤¾äº¤å’Œè¡¨ç°æƒ…å¢ƒä¸­çš„ç„¦è™‘å’Œå›é¿ç¨‹åº¦ï¼Œå¸®åŠ©è¯†åˆ«ç¤¾äº¤ç„¦è™‘éšœç¢çš„ç—‡çŠ¶ã€‚",
        "question_count": 12,
        "estimated_time": 4,
        "icon": "ğŸ˜“",
        "questions": [
            {
                "id": 1,
                "text": "ä¸æƒå¨äººå£«äº¤è°ˆæ—¶çš„ç„¦è™‘ç¨‹åº¦",
                "options": [
                    {"value": 0, "label": "æ— "},
                    {"value": 1, "label": "è½»åº¦"},
                    {"value": 2, "label": "ä¸­åº¦"},
                    {"value": 3, "label": "é‡åº¦"}
                ]
            },
            {
                "id": 2,
                "text": "ä¸æƒå¨äººå£«äº¤è°ˆæ—¶çš„å›é¿ç¨‹åº¦",
                "options": [
                    {"value": 0, "label": "ä»ä¸å›é¿"},
                    {"value": 1, "label": "å¶å°”å›é¿"},
                    {"value": 2, "label": "ç»å¸¸å›é¿"},
                    {"value": 3, "label": "æ€»æ˜¯å›é¿"}
                ]
            },
            {
                "id": 3,
                "text": "åœ¨å°ç»„ä¸­äº¤è°ˆæ—¶çš„ç„¦è™‘ç¨‹åº¦",
                "options": [
                    {"value": 0, "label": "æ— "},
                    {"value": 1, "label": "è½»åº¦"},
                    {"value": 2, "label": "ä¸­åº¦"},
                    {"value": 3, "label": "é‡åº¦"}
                ]
            },
            {
                "id": 4,
                "text": "åœ¨å°ç»„ä¸­äº¤è°ˆæ—¶çš„å›é¿ç¨‹åº¦",
                "options": [
                    {"value": 0, "label": "ä»ä¸å›é¿"},
                    {"value": 1, "label": "å¶å°”å›é¿"},
                    {"value": 2, "label": "ç»å¸¸å›é¿"},
                    {"value": 3, "label": "æ€»æ˜¯å›é¿"}
                ]
            },
            {
                "id": 5,
                "text": "å‚åŠ èšä¼šæ—¶çš„ç„¦è™‘ç¨‹åº¦",
                "options": [
                    {"value": 0, "label": "æ— "},
                    {"value": 1, "label": "è½»åº¦"},
                    {"value": 2, "label": "ä¸­åº¦"},
                    {"value": 3, "label": "é‡åº¦"}
                ]
            },
            {
                "id": 6,
                "text": "å‚åŠ èšä¼šæ—¶çš„å›é¿ç¨‹åº¦",
                "options": [
                    {"value": 0, "label": "ä»ä¸å›é¿"},
                    {"value": 1, "label": "å¶å°”å›é¿"},
                    {"value": 2, "label": "ç»å¸¸å›é¿"},
                    {"value": 3, "label": "æ€»æ˜¯å›é¿"}
                ]
            },
            {
                "id": 7,
                "text": "å½“ä¼—æ¼”è®²æˆ–è¡¨æ¼”æ—¶çš„ç„¦è™‘ç¨‹åº¦",
                "options": [
                    {"value": 0, "label": "æ— "},
                    {"value": 1, "label": "è½»åº¦"},
                    {"value": 2, "label": "ä¸­åº¦"},
                    {"value": 3, "label": "é‡åº¦"}
                ]
            },
            {
                "id": 8,
                "text": "å½“ä¼—æ¼”è®²æˆ–è¡¨æ¼”æ—¶çš„å›é¿ç¨‹åº¦",
                "options": [
                    {"value": 0, "label": "ä»ä¸å›é¿"},
                    {"value": 1, "label": "å¶å°”å›é¿"},
                    {"value": 2, "label": "ç»å¸¸å›é¿"},
                    {"value": 3, "label": "æ€»æ˜¯å›é¿"}
                ]
            },
            {
                "id": 9,
                "text": "åœ¨å…¬å…±åœºæ‰€è¿›é£Ÿæ—¶çš„ç„¦è™‘ç¨‹åº¦",
                "options": [
                    {"value": 0, "label": "æ— "},
                    {"value": 1, "label": "è½»åº¦"},
                    {"value": 2, "label": "ä¸­åº¦"},
                    {"value": 3, "label": "é‡åº¦"}
                ]
            },
            {
                "id": 10,
                "text": "åœ¨å…¬å…±åœºæ‰€è¿›é£Ÿæ—¶çš„å›é¿ç¨‹åº¦",
                "options": [
                    {"value": 0, "label": "ä»ä¸å›é¿"},
                    {"value": 1, "label": "å¶å°”å›é¿"},
                    {"value": 2, "label": "ç»å¸¸å›é¿"},
                    {"value": 3, "label": "æ€»æ˜¯å›é¿"}
                ]
            },
            {
                "id": 11,
                "text": "è¢«ä»–äººæ³¨è§†æ—¶çš„ç„¦è™‘ç¨‹åº¦",
                "options": [
                    {"value": 0, "label": "æ— "},
                    {"value": 1, "label": "è½»åº¦"},
                    {"value": 2, "label": "ä¸­åº¦"},
                    {"value": 3, "label": "é‡åº¦"}
                ]
            },
            {
                "id": 12,
                "text": "è¢«ä»–äººæ³¨è§†æ—¶çš„å›é¿ç¨‹åº¦",
                "options": [
                    {"value": 0, "label": "ä»ä¸å›é¿"},
                    {"value": 1, "label": "å¶å°”å›é¿"},
                    {"value": 2, "label": "ç»å¸¸å›é¿"},
                    {"value": 3, "label": "æ€»æ˜¯å›é¿"}
                ]
            }
        ],
        "scoring_rules": {
            "method": "sum",
            "max_score": 36
        },
        "interpretation": [
            {
                "range": [0, 11],
                "level": "æ— ç¤¾äº¤ç„¦è™‘",
                "interpretation": "æ‚¨åœ¨ç¤¾äº¤æƒ…å¢ƒä¸­è¡¨ç°è‡ªç„¶ï¼Œæ²¡æœ‰æ˜æ˜¾çš„ç¤¾äº¤ç„¦è™‘ç—‡çŠ¶ã€‚",
                "suggestion": "æ‚¨çš„ç¤¾äº¤èƒ½åŠ›è‰¯å¥½ï¼å»ºè®®ï¼š1) ç»§ç»­ä¿æŒç§¯æçš„ç¤¾äº¤äº’åŠ¨ï¼›2) åœ¨èˆ’é€‚çš„åŸºç¡€ä¸Šå°è¯•æ–°çš„ç¤¾äº¤åœºæ™¯ï¼›3) å¯ä»¥å¸®åŠ©æœ‰ç¤¾äº¤å›°éš¾çš„æœ‹å‹ï¼›4) ç»´æŠ¤è‰¯å¥½çš„äººé™…å…³ç³»è´¨é‡ã€‚"
            },
            {
                "range": [12, 18],
                "level": "è½»åº¦ç¤¾äº¤ç„¦è™‘",
                "interpretation": "æ‚¨åœ¨æŸäº›ç¤¾äº¤æƒ…å¢ƒä¸­å¯èƒ½æ„Ÿåˆ°è½»å¾®ä¸é€‚ï¼Œä½†æ€»ä½“å¯ä»¥åº”å¯¹ã€‚",
                "suggestion": "å»ºè®®ï¼š1) è¯†åˆ«è®©æ‚¨ç„¦è™‘çš„å…·ä½“ç¤¾äº¤æƒ…å¢ƒï¼›2) é‡‡ç”¨æ¸è¿›å¼æš´éœ²æ³•é€æ­¥é€‚åº”ï¼›3) ç»ƒä¹ ç¤¾äº¤æŠ€å·§å’Œæ²Ÿé€šæ–¹æ³•ï¼›4) ä½¿ç”¨å¿ƒç¿¼çš„ç¤¾äº¤ç„¦è™‘è®­ç»ƒï¼›5) æŒ‘æˆ˜è´Ÿé¢çš„è‡ªæˆ‘è¯„ä»·ï¼›6) åº†ç¥æ¯ä¸€æ¬¡ç¤¾äº¤æˆåŠŸã€‚"
            },
            {
                "range": [19, 27],
                "level": "ä¸­åº¦ç¤¾äº¤ç„¦è™‘",
                "interpretation": "æ‚¨åœ¨ç¤¾äº¤æƒ…å¢ƒä¸­ç»å¸¸æ„Ÿåˆ°ç„¦è™‘ï¼Œå¹¶å¯èƒ½å› æ­¤å›é¿æŸäº›ç¤¾äº¤æ´»åŠ¨ï¼Œå½±å“ç”Ÿæ´»è´¨é‡ã€‚",
                "suggestion": "å¼ºçƒˆå»ºè®®ï¼š1) å¯»æ±‚ä¸“ä¸šå¿ƒç†å’¨è¯¢æˆ–è®¤çŸ¥è¡Œä¸ºç–—æ³•ï¼ˆCBTï¼‰ï¼›2) å­¦ä¹ æ”¾æ¾æŠ€å·§åº”å¯¹ç„¦è™‘ï¼›3) åŠ å…¥ç¤¾äº¤æŠ€èƒ½è®­ç»ƒå°ç»„ï¼›4) ä½¿ç”¨å¿ƒç¿¼çš„ç³»ç»ŸåŒ–è®­ç»ƒè®¡åˆ’ï¼›5) æŒ‘æˆ˜æ¶ˆææ€ç»´æ¨¡å¼ï¼›6) è®¾å®šæ¸è¿›å¼ç¤¾äº¤ç›®æ ‡ã€‚å¿ƒç†æ´åŠ©çƒ­çº¿ï¼š400-161-9995"
            },
            {
                "range": [28, 36],
                "level": "é‡åº¦ç¤¾äº¤ç„¦è™‘",
                "interpretation": "æ‚¨å­˜åœ¨ä¸¥é‡çš„ç¤¾äº¤ç„¦è™‘ï¼Œæ˜¾è‘—å½±å“æ—¥å¸¸ç”Ÿæ´»ã€å­¦ä¹ æˆ–å·¥ä½œã€‚å¯èƒ½ç¬¦åˆç¤¾äº¤ç„¦è™‘éšœç¢è¯Šæ–­æ ‡å‡†ã€‚",
                "suggestion": "âš ï¸ ç´§æ€¥å»ºè®®ï¼š1) å°½å¿«å¯»æ±‚å¿ƒç†åŒ»ç”Ÿæˆ–ç²¾ç¥ç§‘åŒ»ç”Ÿè¯„ä¼°ï¼›2) éœ€è¦ä¸“ä¸šçš„è®¤çŸ¥è¡Œä¸ºæ²»ç–—ï¼ˆCBTï¼‰ï¼›3) å¯èƒ½éœ€è¦è¯ç‰©é…åˆæ²»ç–—ï¼›4) åŠ å…¥æ”¯æŒå°ç»„è·å¾—ç†è§£å’Œé¼“åŠ±ï¼›5) é¿å…è‡ªæˆ‘å­¤ç«‹ï¼›6) 24å°æ—¶å¿ƒç†æ´åŠ©çƒ­çº¿ï¼š400-161-9995ã€‚ç¤¾äº¤ç„¦è™‘æ˜¯å¯ä»¥æ²»ç–—çš„ï¼Œè¯·ä¸è¦æ”¾å¼ƒï¼"
            }
        ]
    }
]


def _ensure_templates_exist(db: Session):
    """ç¡®ä¿è¯„ä¼°é‡è¡¨æ¨¡æ¿å­˜åœ¨ï¼ˆé¦–æ¬¡è®¿é—®æ—¶è‡ªåŠ¨åˆå§‹åŒ–ï¼‰"""
    existing = db.query(AssessmentTemplate).first()
    if existing:
        return
    
    # è‡ªåŠ¨åˆå§‹åŒ–
    try:
        for template_data in ASSESSMENT_TEMPLATES:
            template = AssessmentTemplate(**template_data)
            db.add(template)
        db.commit()
        logger.info(f"âœ… è‡ªåŠ¨åˆå§‹åŒ– {len(ASSESSMENT_TEMPLATES)} ä¸ªè¯„ä¼°é‡è¡¨")
    except Exception as e:
        logger.error(f"âŒ è‡ªåŠ¨åˆå§‹åŒ–è¯„ä¼°é‡è¡¨å¤±è´¥: {e}")
        db.rollback()


@router.get("/list", response_model=List[AssessmentTemplateListItem])
async def get_assessment_list(
    category: str = None,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """
    è·å–è¯„ä¼°é‡è¡¨åˆ—è¡¨
    å¯é€‰æŒ‰åˆ†ç±»ç­›é€‰ï¼šdepression/anxiety/stress/sleep/personality
    """
    # ç¡®ä¿æ¨¡æ¿å·²åˆå§‹åŒ–
    _ensure_templates_exist(db)
    
    query = db.query(AssessmentTemplate).filter(AssessmentTemplate.is_active == True)
    
    if category:
        query = query.filter(AssessmentTemplate.category == category)
    
    templates = query.order_by(AssessmentTemplate.id).all()
    
    # è·å–ç”¨æˆ·æœ€åå®Œæˆæ—¶é—´
    result = []
    for template in templates:
        last_record = db.query(AssessmentRecord).filter(
            AssessmentRecord.user_id == current_user.id,
            AssessmentRecord.template_id == template.id
        ).order_by(desc(AssessmentRecord.created_at)).first()
        
        item = AssessmentTemplateListItem(
            id=template.id,
            scale_name=template.scale_name,
            display_name=template.display_name,
            category=template.category,
            description=template.description,
            question_count=template.question_count,
            estimated_time=template.estimated_time,
            icon=template.icon,
            last_completed=last_record.created_at if last_record else None
        )
        result.append(item)
    
    return result


@router.get("/{template_id}/template", response_model=AssessmentTemplateDetail)
async def get_assessment_template(
    template_id: int,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """è·å–è¯„ä¼°é‡è¡¨é¢˜ç›®"""
    template = db.query(AssessmentTemplate).filter(
        AssessmentTemplate.id == template_id,
        AssessmentTemplate.is_active == True
    ).first()
    
    if not template:
        raise HTTPException(status_code=404, detail="é‡è¡¨ä¸å­˜åœ¨")
    
    return AssessmentTemplateDetail(
        id=template.id,
        scale_name=template.scale_name,
        display_name=template.display_name,
        category=template.category,
        description=template.description,
        question_count=template.question_count,
        estimated_time=template.estimated_time,
        questions=template.questions,
        icon=template.icon
    )


@router.post("/submit", response_model=AssessmentResultResponse)
async def submit_assessment(
    request: AssessmentSubmitRequest,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """æäº¤è¯„ä¼°ç­”æ¡ˆï¼Œè¿”å›è¯„åˆ†ç»“æœ"""
    # è·å–é‡è¡¨æ¨¡æ¿
    template = db.query(AssessmentTemplate).filter(
        AssessmentTemplate.id == request.template_id
    ).first()
    
    if not template:
        raise HTTPException(status_code=404, detail="é‡è¡¨ä¸å­˜åœ¨")
    
    # éªŒè¯ç­”æ¡ˆæ•°é‡
    if len(request.answers) != template.question_count:
        raise HTTPException(
            status_code=400, 
            detail=f"ç­”æ¡ˆæ•°é‡ä¸åŒ¹é…ï¼ŒæœŸæœ›{template.question_count}é¢˜ï¼Œå®é™…{len(request.answers)}é¢˜"
        )
    
    # è®¡ç®—æ€»åˆ†
    total_score = sum(request.answers)
    
    # æ ¹æ®è¯„åˆ†è§„åˆ™åˆ¤æ–­é£é™©ç­‰çº§å’Œè§£é‡Š
    interpretation_rules = template.interpretation
    risk_level = "unknown"
    interpretation = ""
    suggestions = ""
    
    for rule in interpretation_rules:
        score_range = rule.get("range", [0, 0])
        if score_range[0] <= total_score <= score_range[1]:
            risk_level = rule.get("level", "unknown")
            interpretation = rule.get("interpretation", "")
            suggestions = rule.get("suggestion", "")
            break
    
    # ä¿å­˜è¯„ä¼°è®°å½•
    record = AssessmentRecord(
        user_id=current_user.id,
        template_id=template.id,
        answers=request.answers,
        total_score=total_score,
        risk_level=risk_level,
        interpretation=interpretation,
        suggestions=suggestions
    )
    db.add(record)
    db.commit()
    db.refresh(record)
    
    logger.info(f"ç”¨æˆ· {current_user.username} å®Œæˆè¯„ä¼° {template.scale_name}ï¼Œå¾—åˆ†: {total_score}ï¼Œç­‰çº§: {risk_level}")
    
    # å¦‚æœæ˜¯é«˜é£é™©ï¼Œè®°å½•æ—¥å¿—
    if risk_level in ["severe", "é‡åº¦"]:
        logger.warning(f"âš ï¸ é«˜é£é™©è¯„ä¼° - ç”¨æˆ· {current_user.username}ï¼Œé‡è¡¨ {template.scale_name}ï¼Œå¾—åˆ† {total_score}")
    
    return AssessmentResultResponse(
        id=record.id,
        template_id=template.id,
        scale_name=template.scale_name,
        display_name=template.display_name,
        total_score=total_score,
        risk_level=risk_level,
        interpretation=interpretation,
        suggestions=suggestions,
        created_at=record.created_at
    )


@router.get("/history", response_model=List[AssessmentHistoryItem])
async def get_assessment_history(
    scale_name: str = None,
    limit: int = 20,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """è·å–ç”¨æˆ·è¯„ä¼°å†å²è®°å½•"""
    query = db.query(AssessmentRecord, AssessmentTemplate).join(
        AssessmentTemplate,
        AssessmentRecord.template_id == AssessmentTemplate.id
    ).filter(
        AssessmentRecord.user_id == current_user.id
    )
    
    # å¦‚æœæŒ‡å®šäº†é‡è¡¨ç±»å‹ï¼Œåˆ™ç­›é€‰
    if scale_name:
        query = query.filter(AssessmentTemplate.scale_name == scale_name)
    
    records = query.order_by(desc(AssessmentRecord.created_at)).limit(limit).all()
    
    result = []
    for record, template in records:
        result.append(AssessmentHistoryItem(
            id=record.id,
            scale_name=template.scale_name,
            display_name=template.display_name,
            total_score=record.total_score,
            risk_level=record.risk_level,
            created_at=record.created_at
        ))
    
    return result


@router.get("/{record_id}/result", response_model=AssessmentResultResponse)
async def get_assessment_result(
    record_id: int,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """è·å–è¯„ä¼°ç»“æœè¯¦æƒ…"""
    record = db.query(AssessmentRecord).filter(
        AssessmentRecord.id == record_id,
        AssessmentRecord.user_id == current_user.id
    ).first()
    
    if not record:
        raise HTTPException(status_code=404, detail="è¯„ä¼°è®°å½•ä¸å­˜åœ¨")
    
    template = db.query(AssessmentTemplate).filter(
        AssessmentTemplate.id == record.template_id
    ).first()
    
    return AssessmentResultResponse(
        id=record.id,
        template_id=template.id,
        scale_name=template.scale_name,
        display_name=template.display_name,
        total_score=record.total_score,
        risk_level=record.risk_level,
        interpretation=record.interpretation,
        suggestions=record.suggestions,
        created_at=record.created_at
    )


@router.get("/trends/{scale_name}")
async def get_assessment_trends(
    scale_name: str,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """è·å–è¯„ä¼°è¶‹åŠ¿æ•°æ®ï¼ˆç”¨äºç»˜åˆ¶å†å²æ›²çº¿ï¼‰"""
    # è·å–è¯¥é‡è¡¨çš„æ¨¡æ¿
    template = db.query(AssessmentTemplate).filter(
        AssessmentTemplate.scale_name == scale_name
    ).first()
    
    if not template:
        raise HTTPException(status_code=404, detail="é‡è¡¨ä¸å­˜åœ¨")
    
    # è·å–ç”¨æˆ·è¯¥é‡è¡¨çš„æ‰€æœ‰è®°å½•
    records = db.query(AssessmentRecord).filter(
        AssessmentRecord.user_id == current_user.id,
        AssessmentRecord.template_id == template.id
    ).order_by(AssessmentRecord.created_at).all()
    
    if not records:
        return {"dates": [], "scores": [], "levels": []}
    
    dates = [record.created_at.strftime("%Y-%m-%d %H:%M") for record in records]
    scores = [record.total_score for record in records]
    levels = [record.risk_level for record in records]
    
    return {
        "scale_name": scale_name,
        "display_name": template.display_name,
        "dates": dates,
        "scores": scores,
        "levels": levels,
        "count": len(records)
    }
